<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DorfFriend Auto-Save Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #2c3e50 0%, #4a6741 100%);
            color: #ecf0f1;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #3498db;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .game-area {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .main-panel {
            background: rgba(52, 73, 94, 0.8);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        .sidebar {
            background: rgba(44, 62, 80, 0.9);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        .dwarf-colony {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            min-height: 300px;
            position: relative;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .dwarf {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            position: absolute;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .dwarf.male { background: #3498db; }
        .dwarf.female { background: #e74c3c; }
        .dwarf.pregnant { background: #f39c12; border: 2px solid #e67e22; }
        .dwarf.child { 
            background: #95a5a6; 
            width: 12px; 
            height: 12px; 
        }
        
        .dwarf::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            top: -6px;
            right: -6px;
        }
        
        .dwarf.orange::after { background: #ff6600; }
        .dwarf.blue::after { background: #0066ff; }
        .dwarf.yellow::after { background: #ffff00; }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        button:hover { background: #2ecc71; }
        button:disabled { 
            background: #7f8c8d; 
            cursor: not-allowed; 
        }
        
        .save-button { background: #3498db; }
        .save-button:hover { background: #5dade2; }
        
        .danger-button { background: #e74c3c; }
        .danger-button:hover { background: #ec7063; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-panel {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .stat-panel h4 {
            margin: 0 0 10px 0;
            color: #3498db;
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .save-slots {
            margin-top: 20px;
        }
        
        .save-slot {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .save-slot.empty {
            opacity: 0.5;
            border: 2px dashed #7f8c8d;
        }
        
        .save-slot.auto-save {
            border-left: 4px solid #f39c12;
        }
        
        .save-info {
            flex-grow: 1;
        }
        
        .save-actions {
            display: flex;
            gap: 5px;
        }
        
        .save-actions button {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .status-bar {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.success { background: #27ae60; }
        .status-indicator.warning { background: #f39c12; }
        .status-indicator.error { background: #e74c3c; }
        
        .log-panel {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        
        .log-entry.success { color: #2ecc71; }
        .log-entry.warning { color: #f1c40f; }
        .log-entry.error { color: #e74c3c; }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .saving { animation: pulse 1s infinite; }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 1fr;
            }
            
            .controls {
                grid-template-columns: 1fr 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè∞ DorfFriend Colony Simulation</h1>
            <p>Watch your dwarf colony grow, reproduce, and thrive! Progress automatically saves.</p>
        </div>
        
        <div class="status-bar">
            <div>
                <span class="status-indicator success" id="saveIndicator"></span>
                <span id="saveStatus">Initializing...</span>
            </div>
            <div>
                Population: <strong id="populationCount">0</strong> |
                Game Time: <strong id="gameTime">0</strong>s
            </div>
        </div>
        
        <div class="game-area">
            <div class="main-panel">
                <h3>üèïÔ∏è Colony View</h3>
                <div class="dwarf-colony" id="colonyArea">
                    <!-- Dwarfs will appear here -->
                </div>
                
                <div class="controls">
                    <button onclick="spawnDwarf()">üë∂ Spawn Dwarf</button>
                    <button onclick="advanceTime(100)">‚è© Advance Time</button>
                    <button onclick="triggerMating()">üíï Trigger Mating</button>
                    <button onclick="addResources(50)">‚ö° Add Resources</button>
                    <button class="save-button" onclick="manualSave()">üíæ Manual Save</button>
                    <button class="danger-button" onclick="resetColony()" id="resetBtn">üîÑ Reset Colony</button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-panel">
                        <h4>Population</h4>
                        <div class="stat-value" id="totalPop">0</div>
                        <div>Adults: <span id="adultCount">0</span> | Children: <span id="childCount">0</span></div>
                    </div>
                    
                    <div class="stat-panel">
                        <h4>Reproduction</h4>
                        <div>Pregnant: <span id="pregnantCount">0</span></div>
                        <div>Orange‚ôÇ: <span id="orangeMales">0</span> | Blue‚ôÇ: <span id="blueMales">0</span> | Yellow‚ôÇ: <span id="yellowMales">0</span></div>
                    </div>
                    
                    <div class="stat-panel">
                        <h4>Resources</h4>
                        <div class="stat-value" id="resourceCount">100</div>
                        <div>Generation: <span id="generationCount">1</span></div>
                    </div>
                    
                    <div class="stat-panel">
                        <h4>Activity</h4>
                        <div>Births: <span id="birthCount">0</span></div>
                        <div>Matings: <span id="matingCount">0</span></div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar">
                <h3>üíæ Save Management</h3>
                
                <div class="save-slots" id="saveSlots">
                    <!-- Save slots will be populated here -->
                </div>
                
                <div class="stat-panel" style="margin-top: 20px;">
                    <h4>Auto-Save Settings</h4>
                    <div>Interval: <span id="autoSaveInterval">30</span>s</div>
                    <div>Next save in: <span id="saveCountdown">--</span>s</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="saveProgress"></div>
                    </div>
                    <button onclick="toggleAutoSave()" id="autoSaveBtn">‚è∏Ô∏è Pause Auto-Save</button>
                </div>
                
                <div class="stat-panel" style="margin-top: 20px;">
                    <h4>üìä Save Statistics</h4>
                    <div>Total Saves: <span id="totalSaves">0</span></div>
                    <div>Auto Saves: <span id="autoSaves">0</span></div>
                    <div>Manual Saves: <span id="manualSaves">0</span></div>
                    <div>Storage Used: <span id="storageUsed">0</span> KB</div>
                </div>
                
                <div class="log-panel">
                    <div><strong>Activity Log:</strong></div>
                    <div id="gameLog"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { AutoSaveSystem, SaveUtils } from './AutoSaveSystem.js';
        
        // Game state
        class DorfFriendDemo {
            constructor() {
                this.dwarfs = [];
                this.time = 0;
                this.resources = 100;
                this.generation = 1;
                this.stats = {
                    births: 0,
                    matings: 0,
                    totalSpawned: 0
                };
                
                // Initialize auto-save system
                this.autoSave = new AutoSaveSystem({
                    gameId: 'dorfriend_demo',
                    version: '1.0.0',
                    maxSlots: 5,
                    autoSaveInterval: 30000, // 30 seconds
                    compression: true
                });
                
                // Add custom serializers for our demo
                this.setupCustomSerializers();
                
                // Initialize save system
                this.initializeSaveSystem();
                
                // Start game loop
                this.startGameLoop();
                
                // Initialize UI
                this.initializeUI();
            }
            
            setupCustomSerializers() {
                // Custom dwarf serializer for our demo
                this.autoSave.addSerializer('dwarf', (dwarf) => ({
                    name: dwarf.name,
                    x: dwarf.x,
                    y: dwarf.y,
                    gender: dwarf.gender,
                    isAdult: dwarf.isAdult,
                    reproductionStrategy: dwarf.reproductionStrategy,
                    isPregnant: dwarf.isPregnant,
                    pregnancyTimer: dwarf.pregnancyTimer,
                    age: dwarf.age || 0,
                    maturityTimer: dwarf.maturityTimer || 0
                }));
                
                // Game state serializer
                this.autoSave.addSerializer('gameState', (game) => ({
                    time: game.time,
                    resources: game.resources,
                    generation: game.generation,
                    stats: game.stats
                }));
            }
            
            initializeSaveSystem() {
                // Set up save event listeners
                window.addEventListener('autosave', (event) => {
                    this.handleSaveEvent(event.detail);
                });
                
                // Try to load existing save
                this.loadGame();
                
                // Start auto-save
                this.autoSave.startAutoSave();
                
                // Save on page unload
                window.addEventListener('beforeunload', () => {
                    this.autoSave.performAutoSave();
                });
            }
            
            async loadGame() {
                const saveData = await this.autoSave.loadFromSlot(0); // Auto-save slot
                
                if (saveData) {
                    this.restoreGameState(saveData);
                    this.addLogEntry('Game loaded successfully!', 'success');
                } else {
                    this.addLogEntry('Starting new colony...', 'warning');
                    this.spawnInitialDwarfs();
                }
                
                this.updateUI();
            }
            
            restoreGameState(saveData) {
                // Restore game state
                if (saveData.gameState) {
                    this.time = saveData.gameState.time || 0;
                    this.resources = saveData.gameState.resources || 100;
                    this.generation = saveData.gameState.generation || 1;
                    this.stats = saveData.gameState.stats || { births: 0, matings: 0, totalSpawned: 0 };
                }
                
                // Restore dwarfs
                if (saveData.dwarfs) {
                    this.dwarfs = saveData.dwarfs.map(data => this.createDwarfFromData(data));
                }
            }
            
            createDwarfFromData(data) {
                const dwarf = {
                    name: data.name,
                    x: data.x,
                    y: data.y,
                    gender: data.gender,
                    isAdult: data.isAdult,
                    reproductionStrategy: data.reproductionStrategy,
                    isPregnant: data.isPregnant || false,
                    pregnancyTimer: data.pregnancyTimer || 0,
                    age: data.age || 0,
                    maturityTimer: data.maturityTimer || 0
                };
                
                return dwarf;
            }
            
            spawnInitialDwarfs() {
                for (let i = 0; i < 5; i++) {
                    this.createDwarf(true);
                }
            }
            
            createDwarf(isAdult = false) {
                const names = ['Thorin', 'Balin', 'Dwalin', 'Gloin', 'Oin', 'Bifur', 'Bofur', 'Bombur', 'Dori', 'Nori', 'Ori'];
                const dwarf = {
                    name: names[Math.floor(Math.random() * names.length)] + '_' + Math.floor(Math.random() * 1000),
                    x: Math.random() * 450 + 25,
                    y: Math.random() * 250 + 25,
                    gender: Math.random() < 0.5 ? 'male' : 'female',
                    isAdult: isAdult,
                    age: isAdult ? 1800 + Math.random() * 3600 : Math.random() * 1800,
                    maturityTimer: isAdult ? 0 : 1800 - (Math.random() * 1800),
                    isPregnant: false,
                    pregnancyTimer: 0
                };
                
                // Assign reproduction strategy to males
                if (dwarf.gender === 'male') {
                    dwarf.reproductionStrategy = ['orange', 'blue', 'yellow'][Math.floor(Math.random() * 3)];
                }
                
                this.dwarfs.push(dwarf);
                this.stats.totalSpawned++;
                this.createDwarfElement(dwarf);
                
                return dwarf;
            }
            
            createDwarfElement(dwarf) {
                const element = document.createElement('div');
                element.className = `dwarf ${dwarf.gender}`;
                if (!dwarf.isAdult) element.classList.add('child');
                if (dwarf.isPregnant) element.classList.add('pregnant');
                if (dwarf.reproductionStrategy) element.classList.add(dwarf.reproductionStrategy);
                
                element.style.left = dwarf.x + 'px';
                element.style.top = dwarf.y + 'px';
                element.title = `${dwarf.name} (${dwarf.gender}${dwarf.reproductionStrategy ? ', ' + dwarf.reproductionStrategy : ''})`;
                
                element.onclick = () => this.showDwarfInfo(dwarf);
                
                document.getElementById('colonyArea').appendChild(element);
                dwarf.element = element;
            }
            
            updateDwarfElement(dwarf) {
                if (!dwarf.element) return;
                
                dwarf.element.className = `dwarf ${dwarf.gender}`;
                if (!dwarf.isAdult) dwarf.element.classList.add('child');
                if (dwarf.isPregnant) dwarf.element.classList.add('pregnant');
                if (dwarf.reproductionStrategy) dwarf.element.classList.add(dwarf.reproductionStrategy);
                
                dwarf.element.style.left = dwarf.x + 'px';
                dwarf.element.style.top = dwarf.y + 'px';
            }
            
            showDwarfInfo(dwarf) {
                const info = [
                    `Name: ${dwarf.name}`,
                    `Gender: ${dwarf.gender}`,
                    `Adult: ${dwarf.isAdult ? 'Yes' : 'No'}`,
                    `Age: ${Math.floor(dwarf.age / 60)} minutes`,
                ];
                
                if (dwarf.reproductionStrategy) {
                    info.push(`Strategy: ${dwarf.reproductionStrategy}`);
                }
                
                if (dwarf.isPregnant) {
                    const progress = Math.floor((dwarf.pregnancyTimer / 3600) * 100);
                    info.push(`Pregnancy: ${progress}% complete`);
                }
                
                alert(info.join('\n'));
            }
            
            startGameLoop() {
                setInterval(() => {
                    this.updateGame();
                    this.updateUI();
                }, 100);
            }
            
            updateGame() {
                this.time += 0.1;
                
                // Update dwarfs
                this.dwarfs.forEach(dwarf => {
                    dwarf.age += 0.1;
                    
                    // Maturity
                    if (!dwarf.isAdult && dwarf.maturityTimer <= 0) {
                        dwarf.isAdult = true;
                        if (dwarf.gender === 'male') {
                            dwarf.reproductionStrategy = ['orange', 'blue', 'yellow'][Math.floor(Math.random() * 3)];
                        }
                        this.addLogEntry(`${dwarf.name} reached maturity!`, 'success');
                    } else if (!dwarf.isAdult) {
                        dwarf.maturityTimer -= 0.1;
                    }
                    
                    // Pregnancy
                    if (dwarf.isPregnant) {
                        dwarf.pregnancyTimer += 0.1;
                        if (dwarf.pregnancyTimer >= 3600) {
                            this.giveBirth(dwarf);
                        }
                    }
                    
                    // Random movement
                    if (Math.random() < 0.01) {
                        dwarf.x = Math.max(10, Math.min(460, dwarf.x + (Math.random() - 0.5) * 20));
                        dwarf.y = Math.max(10, Math.min(260, dwarf.y + (Math.random() - 0.5) * 20));
                    }
                    
                    this.updateDwarfElement(dwarf);
                });
                
                // Random events
                if (Math.random() < 0.001) {
                    this.resources += Math.floor(Math.random() * 10) + 1;
                }
            }
            
            giveBirth(mother) {
                mother.isPregnant = false;
                mother.pregnancyTimer = 0;
                
                const baby = this.createDwarf(false);
                baby.x = mother.x + (Math.random() - 0.5) * 40;
                baby.y = mother.y + (Math.random() - 0.5) * 40;
                
                this.stats.births++;
                this.addLogEntry(`${mother.name} gave birth to ${baby.name}!`, 'success');
                
                this.updateDwarfElement(mother);
            }
            
            handleSaveEvent(eventData) {
                const indicator = document.getElementById('saveIndicator');
                const status = document.getElementById('saveStatus');
                
                switch (eventData.type) {
                    case 'autosave':
                        if (eventData.success) {
                            indicator.className = 'status-indicator success';
                            status.textContent = `Auto-saved at ${new Date().toLocaleTimeString()}`;
                            this.addLogEntry('Auto-save completed', 'success');
                        } else {
                            indicator.className = 'status-indicator error';
                            status.textContent = 'Auto-save failed!';
                            this.addLogEntry('Auto-save failed: ' + eventData.error, 'error');
                        }
                        break;
                        
                    case 'save':
                        if (eventData.success) {
                            if (!eventData.isAutoSave) {
                                this.addLogEntry(`Manual save to slot ${eventData.slot}`, 'success');
                            }
                        }
                        break;
                }
                
                this.updateSaveUI();
            }
            
            initializeUI() {
                this.updateUI();
                this.updateSaveUI();
                this.startSaveCountdown();
            }
            
            updateUI() {
                const adults = this.dwarfs.filter(d => d.isAdult);
                const children = this.dwarfs.filter(d => !d.isAdult);
                const pregnant = this.dwarfs.filter(d => d.isPregnant);
                const males = adults.filter(d => d.gender === 'male');
                
                document.getElementById('populationCount').textContent = this.dwarfs.length;
                document.getElementById('gameTime').textContent = Math.floor(this.time);
                document.getElementById('totalPop').textContent = this.dwarfs.length;
                document.getElementById('adultCount').textContent = adults.length;
                document.getElementById('childCount').textContent = children.length;
                document.getElementById('pregnantCount').textContent = pregnant.length;
                document.getElementById('orangeMales').textContent = males.filter(m => m.reproductionStrategy === 'orange').length;
                document.getElementById('blueMales').textContent = males.filter(m => m.reproductionStrategy === 'blue').length;
                document.getElementById('yellowMales').textContent = males.filter(m => m.reproductionStrategy === 'yellow').length;
                document.getElementById('resourceCount').textContent = this.resources;
                document.getElementById('generationCount').textContent = this.generation;
                document.getElementById('birthCount').textContent = this.stats.births;
                document.getElementById('matingCount').textContent = this.stats.matings;
            }
            
            updateSaveUI() {
                const stats = this.autoSave.getStatistics();
                document.getElementById('totalSaves').textContent = stats.totalSaves;
                document.getElementById('autoSaves').textContent = stats.autoSaves;
                document.getElementById('manualSaves').textContent = stats.manualSaves;
                
                const usage = SaveUtils.getStorageUsage('dorfriend_demo');
                document.getElementById('storageUsed').textContent = Math.round(usage.totalSize / 1024);
                
                this.updateSaveSlots();
            }
            
            updateSaveSlots() {
                const saveList = this.autoSave.getSaveList();
                const slotsContainer = document.getElementById('saveSlots');
                slotsContainer.innerHTML = '';
                
                for (let i = 0; i < this.autoSave.maxSlots; i++) {
                    const saveInfo = saveList.find(s => s.slot === i);
                    const slotElement = document.createElement('div');
                    slotElement.className = 'save-slot';
                    
                    if (saveInfo) {
                        if (i === 0) slotElement.classList.add('auto-save');
                        
                        slotElement.innerHTML = `
                            <div class="save-info">
                                <div><strong>Slot ${i}${i === 0 ? ' (Auto)' : ''}</strong></div>
                                <div>${saveInfo.description || 'Manual Save'}</div>
                                <div style="font-size: 11px; opacity: 0.7;">
                                    ${new Date(saveInfo.timestamp).toLocaleString()}
                                </div>
                            </div>
                            <div class="save-actions">
                                <button onclick="game.loadSlot(${i})">üìÅ Load</button>
                                <button onclick="game.saveToSlot(${i})">üíæ Save</button>
                                ${i > 0 ? `<button onclick="game.deleteSlot(${i})">üóëÔ∏è</button>` : ''}
                            </div>
                        `;
                    } else {
                        slotElement.classList.add('empty');
                        slotElement.innerHTML = `
                            <div class="save-info">
                                <div><strong>Slot ${i}</strong></div>
                                <div>Empty</div>
                            </div>
                            <div class="save-actions">
                                <button onclick="game.saveToSlot(${i})">üíæ Save</button>
                            </div>
                        `;
                    }
                    
                    slotsContainer.appendChild(slotElement);
                }
            }
            
            startSaveCountdown() {
                setInterval(() => {
                    if (this.autoSave.isAutoSaving) {
                        const elapsed = Date.now() - (this.autoSave.lastSaveTime || Date.now());
                        const remaining = Math.max(0, this.autoSave.autoSaveInterval - elapsed);
                        const progress = ((this.autoSave.autoSaveInterval - remaining) / this.autoSave.autoSaveInterval) * 100;
                        
                        document.getElementById('saveCountdown').textContent = Math.ceil(remaining / 1000);
                        document.getElementById('saveProgress').style.width = progress + '%';
                    }
                }, 1000);
            }
            
            addLogEntry(message, type = 'info') {
                const log = document.getElementById('gameLog');
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
                
                log.appendChild(entry);
                log.scrollTop = log.scrollHeight;
                
                // Keep only last 50 entries
                while (log.children.length > 50) {
                    log.removeChild(log.firstChild);
                }
            }
            
            // Public methods for UI
            async saveToSlot(slot) {
                const description = slot === 0 ? 'Auto-save' : `Manual save ${slot}`;
                await this.autoSave.saveToSlot(slot, description, slot === 0);
                this.updateSaveUI();
            }
            
            async loadSlot(slot) {
                if (confirm('Load this save? Current progress will be lost.')) {
                    const saveData = await this.autoSave.loadFromSlot(slot);
                    if (saveData) {
                        // Clear current dwarfs
                        document.getElementById('colonyArea').innerHTML = '';
                        
                        this.restoreGameState(saveData);
                        this.updateUI();
                        
                        this.addLogEntry(`Loaded from slot ${slot}`, 'success');
                    }
                }
            }
            
            deleteSlot(slot) {
                if (confirm(`Delete save in slot ${slot}?`)) {
                    this.autoSave.deleteSave(slot);
                    this.updateSaveUI();
                    this.addLogEntry(`Deleted save slot ${slot}`, 'warning');
                }
            }
        }
        
        // Initialize game
        const game = new DorfFriendDemo();
        
        // Global functions for UI
        window.game = game;
        
        window.spawnDwarf = () => {
            game.createDwarf(Math.random() < 0.7);
            game.updateUI();
            game.addLogEntry('Spawned new dwarf', 'success');
        };
        
        window.advanceTime = (seconds) => {
            game.time += seconds;
            game.addLogEntry(`Advanced time by ${seconds}s`, 'info');
        };
        
        window.triggerMating = () => {
            const adults = game.dwarfs.filter(d => d.isAdult);
            const males = adults.filter(d => d.gender === 'male');
            const females = adults.filter(d => d.gender === 'female' && !d.isPregnant);
            
            if (males.length > 0 && females.length > 0) {
                const male = males[Math.floor(Math.random() * males.length)];
                const female = females[Math.floor(Math.random() * females.length)];
                
                if (Math.random() < 0.7) {
                    female.isPregnant = true;
                    female.pregnancyTimer = 0;
                    game.stats.matings++;
                    game.addLogEntry(`${male.name} and ${female.name} are expecting!`, 'success');
                } else {
                    game.addLogEntry('Mating attempt failed', 'warning');
                }
            }
        };
        
        window.addResources = (amount) => {
            game.resources += amount;
            game.addLogEntry(`Added ${amount} resources`, 'success');
        };
        
        window.manualSave = async () => {
            const success = await game.autoSave.saveToSlot(1, 'Manual save', false);
            if (success) {
                game.addLogEntry('Manual save completed', 'success');
            }
            game.updateSaveUI();
        };
        
        window.resetColony = () => {
            if (confirm('Reset the entire colony? All progress will be lost!')) {
                // Clear storage
                SaveUtils.clearAllSaves('dorfriend_demo');
                
                // Reload page
                location.reload();
            }
        };
        
        window.toggleAutoSave = () => {
            const btn = document.getElementById('autoSaveBtn');
            if (game.autoSave.isAutoSaving) {
                game.autoSave.stopAutoSave();
                btn.textContent = '‚ñ∂Ô∏è Resume Auto-Save';
                game.addLogEntry('Auto-save paused', 'warning');
            } else {
                game.autoSave.startAutoSave();
                btn.textContent = '‚è∏Ô∏è Pause Auto-Save';
                game.addLogEntry('Auto-save resumed', 'success');
            }
        };
        
        console.log('DorfFriend Auto-Save Demo initialized!');
        console.log('Debug: window.game available for inspection');
    </script>
</body>
</html>